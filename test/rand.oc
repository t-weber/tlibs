#
# random numbers test
# @author Tobias Weber <tobias.weber@tum.de>
# @date 19-feb-19
# @license GPLv2 or GPLv3
#


function [ Ns, means ] = estimate_number(N, inc, max)
	Ns = [];
	Ks = [];
	means = [];

	for n = 0 : N-1
		k = 0.;
		x = 0.;

		while true
			x = x + rand();
			k = k + inc;

			if x > max
				break;
			endif
		endwhile

		Ns = [ Ns, n ];
		Ks = [ Ks, k ];
		means = [ means, mean(Ks) ];
	endfor
endfunction


# -----------------------------------------------------------------------------


function x = walk(N, p, l1, l2)
	x = 0.;

	for n = 0 : N-1
		r01 = rand();

		if r01 < p
			x = x + l1;
		else
			x = x + l2;
		endif
	endfor
endfunction



function [ Nsteps, sig2 ] = mean_walk(N_iters, N_steps, p, l1, l2)
	Nsteps = [];
	sig2 = [];

	for n_step = 0 : N_steps-1
		xs = [];

		for n_iter = 1 : N_iters
			x = walk(n_step, p, l1, l2);
			xs = [ xs, x ];
		endfor

		# sig^2 = <x^2> - <x>^2 = <x^2>
		Nsteps = [ Nsteps, n_step ];
		sig2 = [ sig2, mean(xs .* xs) ];
	endfor
endfunction



function [ m, t ] = solve_linear_approx(xs, ys)
	[Q, R] = qr([ xs.^1; xs.^0 ]');

	ys_new = (R' * Q') * ys';
	xs_new = inv(R'*R) * ys_new;

	m = xs_new(1);
	t = xs_new(2);
endfunction




# -----------------------------------------------------------------------------
rand_iters = 1000;
rand_steps = 25;
printf("Number of iterations: %d.\n", rand_iters);
printf("Number of steps: %d.\n", rand_steps);
# -----------------------------------------------------------------------------



# -----------------------------------------------------------------------------
[Ns, means] = estimate_number(rand_iters, 1., 1.);
printf("e = %g\n", means(length(means)));

fig = figure();
xlabel("Iterations");
ylabel("Value");
xlim([0., max(Ns)]);
ylim([2., 3.]);
hold on
plot(Ns, means, "o");
plot([0, max(Ns)], [exp(1), exp(1)], "-");
print(fig, "estimate.pdf");
# -----------------------------------------------------------------------------



# -----------------------------------------------------------------------------
[ns, sig2] = mean_walk(rand_iters, rand_steps, 0.5, 1., -1.);
[m, t] = solve_linear_approx(ns, sig2);
printf("line: m = %g, t = %g\n", m, t);

clf(fig);
#fig = figure(2);
xlabel("Steps");
ylabel("sigma^2");
xlim([0., max(ns)]);
ylim([0., max(sig2)]);
hold on
plot(ns, sig2, "o");
plot(ns, ns.*m .+ t, "-");
print(fig, "walk.pdf");
# -----------------------------------------------------------------------------
